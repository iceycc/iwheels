## lerna是什么？
> - lerna是GitHub上面开源的一款js代码库管理软件， 用来对一系列相互耦合比较大、又相互独立的js git库进行管理。解决各个库之间修改混乱、难以跟踪的问题。lerna可以优化这种情形下的工作流。
> - 对于一些功能比较全的库，我们往往会把各个小功能拆分成独立的npm库，他们直接有比较强的依赖关系。比如：Babel、React等开源代码都是按照这种方式进行处理的。

## 代码库结构
lerna管理的库文件结构类似如下这样
```
my-lerna-repo/
  package.json
  packages/
    package-1/
      package.json
    package-2/
      package.json
```
## lerna主要做了什么
- Lerna 中的两个主要命令是`lerna bootstrap`和 `lerna publish`。
- bootstrap将 repo 中的依赖项链接在一起。 publish将帮助发布任何更新的包。
## lerna怎么运作
### 固定/锁定模式（默认）
- 固定模式 Lerna 项目在单个版本行上运行。该版本保存在lerna.json项目根目录下的文件中version。运行时lerna publish，如果模块自上次发布以来已更新，则它将更新为您发布的新版本。这意味着您仅在需要时发布包的新版本。

> 注意：如果您的主要版本为零，则所有更新都被视为破坏. 因此，lerna publish使用主版本零运行并选择任何非预发布版本号将导致为所有包发布新版本，即使自上次发布以来并非所有包都已更改。

- 这是Babel目前使用的模式。如果您想自动将所有软件包版本绑定在一起，请使用此选项。这种方法的一个问题是，任何包的重大更改都会导致所有包都具有新的主要版本。

### 独立模式
`lerna init --independent`
- 独立模式的 Lerna 项目允许维护者彼此独立地增加包版本。每次发布时，您都会收到有关已更改的每个包的提示，以指定它是补丁、次要、主要还是自定义更改。
- 独立模式允许您更具体地更新每个包的版本并对一组组件有意义。将这种模式与语义释放之类的东西结合起来会减少痛苦。（在`atlassian/lerna-semantic-release`已经有这方面的工作）。

将 `lerna.json` 中的`version`为`independent`以独立模式运行。

## 入门
安装 2.x版本以上都行。我用的 lerna 3.22.1
```shell script
npm install --global lerna
```

创建一个新的git仓库
```shell script
git init i-iwheel && cd i-iwheel
```
现在让我们把它变成一个 Lerna 仓库：
```shell script
lerna init
```
得到仓库目录：
```
lerna-repo/
  packages/
  package.json
  lerna.json
```
### 基本命令
https://github.com/lerna/lerna#readme
- `lerna init` 创建一个新的 lerna 存储库或将现有存储库升级到 Lerna 的当前版本。
    
    > 选项 `--independent/`  -i– 使用独立版本控制模式。
- `lerna bootstrap` 引导当前 Lerna 存储库中的包。安装它们的所有依赖项并链接任何交叉依赖项。  
    
    > 此命令至关重要，因为它允许您使用包名称，`require()`时这些包就像已经存在并且在您的node_modules文件夹中可用一样。
- `lerna import <pathToRepo>` 将本地路径 <pathToRepo> 中的包导入到带有提交历史记录的包/<directory-name> 中。
- `lerna publish` 创建已更新包的新版本。提示新版本并更新 git 和 npm 上的所有包。  
    > 选项  
    `--npm-tag [tagname]` — 使用给定的 npm dist-tag（默认为最新）发布到 npm。  
    `--canary/ -c` – 创建金丝雀版本。  
    `--skip-git` – 不要运行任何 git 命令。  
    `--force-publish [packages]` — 强制发布指定的包（逗号分隔）或所有包使用 *（跳过对已更改包的 git diff 检查）。              
- `lerna changed`  检查自上次发布以来哪些包发生了变化。
- `lerna diff [package?]` 比较自上次发布以来的所有包或单个包。
- `lerna run [script]` 在包含该脚本的每个包中 运行一个 [npm脚本](https://docs.npmjs.com/cli/v7/using-npm/scripts/) 。
- `lerna ls` 列出当前 Lerna 存储库中的所有公共包。
- `lerna clean` 清除所以模块依赖
- `lerna create <projectName> <directory>` 增加模块
- `lerna add <package>[@version] [--dev] [--exact] --scope=[packeage]` scope制定给哪个包增加依赖，注意不是目录，是对应package.json的name
- 其他查看 https://github.com/lerna/lerna#readme 



相关链接：

https://segmentfault.com/a/1190000023954051

