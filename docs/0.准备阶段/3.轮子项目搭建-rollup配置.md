## 官网
https://www.rollupjs.com/



## 创建基本项目

增加utils包，主要开发纯js的轮子
- 创建utils包`lerna create @iwheels/utils packages`
- 进入包目录： `cd packages/utils`
- 创建开发目录：`src`源码位置，ts编写 ；`dist` 目录作为输出目录，下面rollup配置还有ts配置都是基于这个配置的。
- 创建 `.babelrc`:
    ```json
    {
      "presets": [
        [
          "@babel/env",
          {
            "modules":false
          }
        ]
      ]
    }
    ```
- 安装各种依赖 
    ```shell script
    npm i -D @rollup/plugin-commonjs @rollup/plugin-node-resolve  @rollup/plugin-typescript rollup-plugin-babel rollup-plugin-livereload rollup-plugin-serve rollup-plugin-terser
    ```
- 新建tsconfig.json
    ```json
    {
      "compilerOptions": {
        "baseUrl": "lib",
        "outDir": "dist",
        "skipLibCheck": true,
        "allowSyntheticDefaultImports": true,
        "module": "ESNext",
        "moduleResolution": "node",
        "noImplicitAny": false,
        "rootDir": "lib",
        "sourceMap": true,
        "strict": false,
        "target": "es5",
        "declaration": true,
        "experimentalDecorators": true,
        "forceConsistentCasingInFileNames": false,
        "noImplicitReturns": true,
        "noImplicitThis": true,
        "strictNullChecks": true,
        "suppressImplicitAnyIndexErrors": true,
        "noUnusedLocals": false
      },
      "exclude": [
        "node_modules",
        "dist"
      ],
      "include": [
        "./lib/**/*"
      ]
    }
    ```
- 配置rollup.config.js
    ```js
    import babel from 'rollup-plugin-babel';
    import resolve from '@rollup/plugin-node-resolve'; // 支持解析引入node_modules下的包
    import commonjs from '@rollup/plugin-commonjs'; // 支持commonjs引入
    import typescript from "@rollup/plugin-typescript"; // 支持ts
    import {terser} from 'rollup-plugin-terser'; // 压缩js
    // import postcss from 'rollup-plugin-postcss'; // 解析css
    import serve from 'rollup-plugin-serve'; // 本地服务器
    import livereload from "rollup-plugin-livereload"; // 自动重启
    export default {
        input:'./lib/index.ts',
        output:{
            file:'./dist/index.js',
            format:'umd', // 6种输出格式,amd/es/iife/umd/cjs/system
            name:'iUtils' // 导出全局变量
        },
        plugins:[
            babel({
                exclude:"node_modules/**"
            }),
            resolve(),
            commonjs(),
            typescript(),
            // terser(),
            // postcss(),
            serve({
                open:true,
                port:8150,
                contentBase:'./'
            }),
            livereload()
        ],
        // external:['lodash']
    }
    ```
- 配置开发环境文件：
    ```js
    import babel from 'rollup-plugin-babel';
    import resolve from '@rollup/plugin-node-resolve'; // 支持解析引入node_modules下的包
    import commonjs from '@rollup/plugin-commonjs'; // 支持commonjs引入
    import typescript from "@rollup/plugin-typescript"; // 支持ts
    import {terser} from 'rollup-plugin-terser'; // 压缩js
    import postcss from 'rollup-plugin-postcss';
    import serve from 'rollup-plugin-serve';
    export default {
        input:'./src/index.ts',
        output:{
            file:'./dist/bundle.js',
            format:'umd', // 6种输出格式,amd/es/iife/umd/cjs/system
            name:'iUtils'
        },
        plugins:[
            babel({
                exclude:"node_modules/**"
            }),
            resolve(),
            commonjs(),
            typescript(),
            terser(),
            postcss()
        ],
        external:['lodash']
    }
    ```
- 增加执行脚本,修改 main 属性,其他属性默认
    ```json
    { 
        "main": "dist/index.js",
        "scripts": {
          "serve": "rollup --config -w",
          "build:watch": "rollup -w --config rollup.config.build.js",
          "build": "rollup --config rollup.config.build.js"
        }
    }
    ```
- 同级创建一个index.html文件  
  
    ```html
    <!doctype html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Document</title>
    </head>
    <body>
    <script src="./dist/index.js"></script>
    <script>
        // 此处名称就是rollup.config.js里 output 配置name：iUtils(自己配置)，打包umd在浏览器模式会导出一个全局变量iUtils
        iUtils()
    </script>
    </body>
    </html>
    ```
- 新增或者修改lib的入口文件 `index.ts`:
    ```js
    'use strict';
    function index() {
        // TODO
        console.log('hello')
    }
    // module.exports = index // 打包报错 index.js:15 Uncaught ReferenceError: module is not defined
    export default index
    ```
## 开发
1. 浏览器直接打开
   启动开发模式 `npm run serve`
   自动打开浏览器, 然后打开控制台，network请求`dist/index.js`,控制台可以看到打印输出。可以愉快的开发了
2. 基于lerna协同开发开发,
   - 打包并监听文件变化`npm run build:watch`
   - 给之前创建的demo项目添加包的软链接： `lerna add @iwheels/utils --scoped=@examples/react-demo`
   - 然后在 `react-demo`项目中找个页面引用
        ```js
        import iUtils from '@examples/react-dome'
        iUtils() //可以执行了 
        ```
- 打包模式：`npm run build`      

